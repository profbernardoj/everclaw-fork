# 2026-02-12

## Gateway Guardian v2 (21:20 CST)

David reported being offline again — Venice DIEM credits ran out, all providers entered cooldown, and the agent was brain-dead. Had to manually run `sudo curl -fsSL https://clawd.bot/install.sh | bash` to get back online.

### Root Cause (same as Feb 11)
The Gateway Guardian v1 only checked HTTP health (dashboard alive = OK). But the failure mode is that the gateway process is alive and HTTP 200 while ALL model providers are in cooldown. Gateway alive ≠ agent functional.

### Gateway Guardian v2 — What Changed
1. **Inference probe (NEW):** After HTTP check passes, runs `openclaw agent --message "Reply with only the word ALIVE"` to verify actual inference works
2. **Separate failure counters:** HTTP failures (2 threshold) and inference failures (3 threshold, ~6 min) tracked independently
3. **Nuclear restart option (NEW):** Step 4 escalation runs `curl -fsSL https://clawd.bot/install.sh | bash` — the exact command David had to run manually
4. **Signal notification (NEW):** Attempts to notify David via signal-cli before going nuclear
5. **macOS timeout fix:** Uses perl-based `run_with_timeout` since macOS lacks `timeout(1)`
6. **Gateway token auto-detection:** Reads OPENCLAW_GATEWAY_TOKEN from launchd plist for authenticated probes

### Restart Escalation Chain
1. `openclaw gateway restart` (graceful — resets cooldown state)
2. Hard kill (`kill -9`) + launchd KeepAlive auto-restart
3. `launchctl kickstart -k` (force restart)
4. **NUCLEAR:** `curl -fsSL https://clawd.bot/install.sh | bash` (full reinstall)

Each step verifies inference works (not just HTTP) before declaring success.

### Files Changed
- `skills/everclaw/scripts/gateway-guardian.sh` — complete rewrite (v1 → v2)
- `~/.openclaw/workspace/scripts/gateway-guardian.sh` — deployed copy
- `~/Library/LaunchAgents/ai.openclaw.guardian.plist` — added OPENCLAW_GATEWAY_TOKEN env var

### Key Insight
The real fix for "all providers in cooldown" is simply restarting the gateway. OpenClaw's cooldown state is in-memory — a restart clears it. The nuclear reinstall (`curl install.sh | bash`) is a guaranteed clean restart because it reinstalls the binary and restarts the launchd service.

### Inference Probe Evolution
- First attempt used `openclaw agent --message` but that requires `--to` or `--session-id` — doesn't work headless
- Second attempt tried `openclaw health --json` but that only checks process health, not model availability
- **Final approach:** Direct HTTP probes to provider endpoints (Venice `/api/v1/models`, Morpheus `/health`, mor-gateway `/api/v1/models`). If ANY provider responds, inference is available. Simple, fast, no auth needed.
- macOS lacks `timeout` command — not needed for the final approach (curl has `--max-time`)

## Everclaw v0.9.0 Published (21:47 CST)

David requested v0.9.0 release. Tagged and pushed to GitHub.

### Changes
- **SKILL.md:** v0.8.0 → v0.9.0, Gateway Guardian section rewritten for v2 (inference probes, 4-stage escalation, state files, config table)
- **README.md:** Guardian feature table updated (HTTP+inference probes, nuclear restart, Signal notification)
- **Website (docs/index.html + website/index.html):** v0.9.0 badge, "What's New in v0.9" hero section, updated Guardian card, v0.8 moved to history row, 6-column version history
- **Tag:** v0.9.0 on `profbernardoj/everclaw`

### Guardian v2 Tested Successfully
- Manual `--verbose` test: `OK: Fully healthy (PID=, HTTP=200, venice=ok)`
- launchd auto-run confirmed (runs=1, exit code 0)
- Provider probes work: Venice API returns 200, Morpheus proxy returns `{"status":"ok"}` with 2 active sessions (kimi-k2.5 + glm-4.7-flash expiring ~Feb 18)

### Venice DIEM Credits
- Venice uses "DIEM" as internal credit/pricing unit (maps 1:1 to USD pricing)
- When DIEM credits exhaust, Venice returns billing errors → cooldown cascade
- Credits appear to reset daily (David was offline during the day, back in evening)

## Multi-Key Auth Rotation Setup (22:01 CST)

David revealed he has 6 Venice API keys. Previously only one was configured, which is why the backup key was never used — OpenClaw's auth system was never told about it.

### Root Cause
OpenClaw supports multiple auth profiles per provider with automatic rotation (built in). But we only had `venice:default` with one key. The second key existed but wasn't registered as an auth profile.

### Fix
Added all 6 keys as `venice:key1` through `venice:key6` in auth-profiles.json, with explicit `auth.order.venice` in openclaw.json to try them in DIEM-balance order:

| Profile | DIEM Balance | Key Suffix |
|---------|-------------|------------|
| venice:key1 | 98 | ...uFbwtvu4QaUV |
| venice:key2 | 50 | ...sfZ7GG6FJ4_p |
| venice:key3 | 40 | ...PkVPLcch5PTe |
| venice:key4 | 26 | ...N_W2vRAMdsua |
| venice:key5 | 20 | ...CI5ozHZRHWSc |
| venice:key6 | 12 | ...ZsVJc7pfn2yD |

### Key Learning: auth.order is Critical
Without `auth.order`, OpenClaw uses round-robin (oldest-used first), which doesn't respect credit balances. Explicit order ensures highest-credit key is always tried first.

### Key Learning: Billing Disable vs Cooldown
- Billing errors → **profile disabled** (5-hour backoff, doubles per failure, caps 24h)
- Rate limit errors → **cooldown** (1→5→25→60 min exponential)
- Both only affect the specific profile, not the provider. Other profiles for same provider remain active.

### Session Stickiness
OpenClaw pins a chosen auth profile per session (cache-friendly). Won't flip-flop mid-conversation. Rotates only on billing failure, session reset, or compaction.

## Everclaw v0.9.1 Published (22:16 CST)

### Changes
- **SKILL.md:** Section 13 rewritten with multi-key setup guide, auth.order config, rotation mechanics, DIEM credit cost table, complete failover docs
- **README:** Multi-key rotation added to core features table
- **Website:** v0.9.1 badge, dual-column What's New, new Multi-Key feature card
- **Tag:** v0.9.1 on profbernardoj/everclaw

## ClawHub Name Collision + Safe Installer (22:26 CST)

### Problem
User Barry installed Everclaw v0.7 via git. His agent Janet ran `clawhub update everclaw` to upgrade to v0.8. ClawHub fetched a COMPLETELY DIFFERENT product — "Everclaw Vault" (encrypted cloud memory, slug `everclaw`, owner `kn732f1vmcycvykq1gp4meydas80dshj`, v0.3.3) — and overwrote Barry's entire skills/everclaw/ directory.

Runtime infrastructure survived (~/morpheus/, proxy, guardian live outside skill dir). But all docs, scripts, references, security tools in the skill folder were nuked.

### Root Cause
1. Someone else published "Everclaw Vault" under the `everclaw` slug on ClawHub
2. Our skill is distributed via `git clone` but has no ClawHub marker
3. `clawhub update` matches by directory name → fetches from registry → overwrites

### Fixes (v0.9.2)
1. **install-everclaw.sh** — safe installer with collision detection, git-based updates, version check
2. **CLAWHUB_WARNING.md** — prominent warning file with recovery steps
3. **SKILL.md** — collision warning banner, new install section with safe installer
4. **README.md** — curl|bash installer as primary, collision warnings throughout
5. **Website** — updated install steps, What's New covers collision protection

### ClawHub Publishing (pending)
- Our profbernardoj GitHub account is only 3 days old, ClawHub requires 7 days
- Plan: David publishes from his account under slug `everclaw-inference`
- Steps prepared for David to execute manually

### Tag: v0.9.2 pushed to profbernardoj/everclaw
