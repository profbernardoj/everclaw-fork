# 2026-02-12

## Gateway Guardian v2 (21:20 CST)

David reported being offline again — Venice DIEM credits ran out, all providers entered cooldown, and the agent was brain-dead. Had to manually run `sudo curl -fsSL https://clawd.bot/install.sh | bash` to get back online.

### Root Cause (same as Feb 11)
The Gateway Guardian v1 only checked HTTP health (dashboard alive = OK). But the failure mode is that the gateway process is alive and HTTP 200 while ALL model providers are in cooldown. Gateway alive ≠ agent functional.

### Gateway Guardian v2 — What Changed
1. **Inference probe (NEW):** After HTTP check passes, runs `openclaw agent --message "Reply with only the word ALIVE"` to verify actual inference works
2. **Separate failure counters:** HTTP failures (2 threshold) and inference failures (3 threshold, ~6 min) tracked independently
3. **Nuclear restart option (NEW):** Step 4 escalation runs `curl -fsSL https://clawd.bot/install.sh | bash` — the exact command David had to run manually
4. **Signal notification (NEW):** Attempts to notify David via signal-cli before going nuclear
5. **macOS timeout fix:** Uses perl-based `run_with_timeout` since macOS lacks `timeout(1)`
6. **Gateway token auto-detection:** Reads OPENCLAW_GATEWAY_TOKEN from launchd plist for authenticated probes

### Restart Escalation Chain
1. `openclaw gateway restart` (graceful — resets cooldown state)
2. Hard kill (`kill -9`) + launchd KeepAlive auto-restart
3. `launchctl kickstart -k` (force restart)
4. **NUCLEAR:** `curl -fsSL https://clawd.bot/install.sh | bash` (full reinstall)

Each step verifies inference works (not just HTTP) before declaring success.

### Files Changed
- `skills/everclaw/scripts/gateway-guardian.sh` — complete rewrite (v1 → v2)
- `~/.openclaw/workspace/scripts/gateway-guardian.sh` — deployed copy
- `~/Library/LaunchAgents/ai.openclaw.guardian.plist` — added OPENCLAW_GATEWAY_TOKEN env var

### Key Insight
The real fix for "all providers in cooldown" is simply restarting the gateway. OpenClaw's cooldown state is in-memory — a restart clears it. The nuclear reinstall (`curl install.sh | bash`) is a guaranteed clean restart because it reinstalls the binary and restarts the launchd service.

### Inference Probe Evolution
- First attempt used `openclaw agent --message` but that requires `--to` or `--session-id` — doesn't work headless
- Second attempt tried `openclaw health --json` but that only checks process health, not model availability
- **Final approach:** Direct HTTP probes to provider endpoints (Venice `/api/v1/models`, Morpheus `/health`, mor-gateway `/api/v1/models`). If ANY provider responds, inference is available. Simple, fast, no auth needed.
- macOS lacks `timeout` command — not needed for the final approach (curl has `--max-time`)

## Everclaw v0.9.0 Published (21:47 CST)

David requested v0.9.0 release. Tagged and pushed to GitHub.

### Changes
- **SKILL.md:** v0.8.0 → v0.9.0, Gateway Guardian section rewritten for v2 (inference probes, 4-stage escalation, state files, config table)
- **README.md:** Guardian feature table updated (HTTP+inference probes, nuclear restart, Signal notification)
- **Website (docs/index.html + website/index.html):** v0.9.0 badge, "What's New in v0.9" hero section, updated Guardian card, v0.8 moved to history row, 6-column version history
- **Tag:** v0.9.0 on `profbernardoj/everclaw`

### Guardian v2 Tested Successfully
- Manual `--verbose` test: `OK: Fully healthy (PID=, HTTP=200, venice=ok)`
- launchd auto-run confirmed (runs=1, exit code 0)
- Provider probes work: Venice API returns 200, Morpheus proxy returns `{"status":"ok"}` with 2 active sessions (kimi-k2.5 + glm-4.7-flash expiring ~Feb 18)

### Venice DIEM Credits
- Venice uses "DIEM" as internal credit/pricing unit (maps 1:1 to USD pricing)
- When DIEM credits exhaust, Venice returns billing errors → cooldown cascade
- Credits appear to reset daily (David was offline during the day, back in evening)
